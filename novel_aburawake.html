<!DOCTYPE html>
<html lang="ja">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
    <meta charset="UTF-8" name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>油分けの間</title>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <!-- font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"
        integrity="sha512-GWzVrcGlo0TxTRvz9ttioyYJ+Wwk9Ck0G81D+eO63BaqHaJ3YZX9wuqjwgfcV/MrB2PhaVX9DkYVhbFpStnqpQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Katex -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
        crossorigin="anonymous"></script>

    <!-- $などで囲うために必要 -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "\\[", right: "\\]", display: true },
                    { left: "$", right: "$", display: false }
                ]
            });
        });
    </script>

    <!-- novel ui 共通 -->
    <link rel="stylesheet" href="./css/novel.css">

    <style>
        #game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
            box-sizing: border-box;
            background: url('./images/rpg/bg_aburawake.jpg') no-repeat center center;
            background-size: cover;
        }

        #explanation {
            display: none;
            background: #ffffff;
            padding: 1rem;
            background-image: url("./images/background/1.jpg");
            background-repeat: repeat-y;
            background-position: right;
            background-size: 25%;
            max-width: 800px;
            text-align: left;

        }
    </style>
</head>

<body>
    <div id="game-container">
        <img id="character" src="" alt="画像" style="display: none;">
        <div id="text-box">
            <div id="story-text"></div>
            <div id="choices">
                <div class="choice-button" id="next">・解説に進む ▶︎</div>
                <div class="choice-button" id="reload">・もう一度、話を聞く ▶︎</div>
                <div class="choice-button" id="map_back">・マップに戻る ▶︎</div>
            </div>
        </div>

        <div class="attribution">
            葛飾北斎 (六大浮世絵師決定版) 野口米次郎 著, 国立国会図書館デジタルコレクション , インターネット公開（保護期間満了）
        </div>

    </div>

    <center>
        <div id="explanation" class="p-5">

            <div class="item_title">
                <img src="./images/icon/tempura.svg" id="img_midashi" alt=tempuraのアイコン"> 油分け算
            </div>

            <div class="grid">
                <div class="grid-inline">
                    <a href="./data/aburawake1.jpg" data-lightbox="aburawake" data-title="油分け算"><img
                            src="./data/aburawake1.jpg" alt="油分け算" width="100%"></a>
                </div>
                <div class="grid-inline">
                    <a href="./data/aburawake2.jpg" data-lightbox="aburawake" data-title="現代語訳"><img
                            src="./data/aburawake2.jpg" alt="油分け算" width="100%"></a>
                </div>
            </div>

            <div id="literature">
                『新編塵劫記 3巻』吉田光由 著, 国立国会図書館デジタルコレクション , インターネット公開（保護期間満了）
            </div>

            <div>

                <h3> 模範回答</h3>
                <p>$3ℓ$のコップを使って、$7ℓ$のコップが満杯になるまで入れると、$3 × 3 - 7 = 2ℓ$残る。$7ℓ$のコップを桶に戻して、$2ℓ$を入れて、もう一度、$3ℓ$のコップを入れれば、$2 +
                    3 =
                    5ℓ$となる。</p>

                <h3 class="text-xl my-5" id="manual_h3">生成AIによる解法</h3>
                <p class="misstake">誤答</p>
                <p class="my-5">コップに移動させる過程で、何度も誤りを指摘したのですが、修正されることは無かったです。</p>
                <div><a href="./data/ai/aburawake.jpg" data-lightbox="aburawake" data-title="生成AIの解法"><img
                            src="./data/ai/aburawake.jpg" width="100%" alt="生成AIの解法"></a></div>

            </div>

            <div class="div_right" id="story_back">
                <span class="top"><i class="fa-solid fa-angles-up"></i> TOP</span>
                <span class="story_back" onclick="location.reload();">Story Back</span>
            </div>

        </div>
    </center>

    <script type="module">
        const story = [
            {
                text: "[あなた]...ここはどこだろう？",
                character: null // 画像を非表示にしたい場合
            },
            {
                text: "[あなた]さっきとは違う空間のようだな...",
                character: null
            },
            {
                text: "[？？？]おいおい、勝手に入り込んで、驚かせてくれるじゃねぇか。",
                character: "./images/rpg/set_hokusai.jpg"
            },
            {
                text: "[あなた]ん？誰だろう？？？",
                character: null
            },
            {
                text: "[葛飾北斎]オレぁ葛飾北斎。江戸一番の絵描きだ。ま、世間じゃ“画狂老人”なんて呼ばれたりもしてるがね。",
                character: "./images/rpg/set_hokusai.jpg"
            },
            {
                text: "[あなた]か、葛飾北斎！？あの“富嶽三十六景”の...？",
                character: null
            },
            {
                text: "[あなた]本物の北斎さんですか？",
                character: null
            },
            {
                text: "[葛飾北斎]本物もなにも、他に誰がいるってんだ？ほらほら、お前さん、もっと驚け驚け！",
                character: "./images/rpg/set_hokusai.jpg"
            },
            {
                text: "[人物紹介]葛飾北斎（1760–1849）。江戸時代後期の浮世絵師にして、日本美術を世界に知らしめた巨匠。",
                character: "./images/rpg/set_hokusai.jpg"
            },
            {
                text: "[人物紹介]代表作『富嶽三十六景』は、ゴッホやモネをも魅了した。",
                character: "./images/rpg/set_hokusai.jpg"
            },
            {
                text: "[人物紹介]生涯で絶えず画号を変え、70回以上の引っ越しを行うなど、型破りで創作に没頭した芸術家である。",
                character: "./images/rpg/set_hokusai.jpg"
            },
            {
                text: "[葛飾北斎]で、だ。お前さん、ただ迷い込んできたってわけじゃねえだろ？ここに来たってことは、和算を解きにきたんじゃないのか？",
                character: "./images/rpg/set_hokusai.jpg"
            },
            {
                text: "[あなた]和算...問題を出してくれるんですか？",
                character: null
            },
            {
                text: "[葛飾北斎]おうよ！ 江戸の職人は算術にも強くなくちゃな。じゃあ一つ、北斎流・和算問答、いってみようじゃねぇか。",
                character: "./images/rpg/set_hokusai.jpg"
            },
            {
                text: "[問題]今、桶には10ℓの油が入っている。7ℓのコップと3ℓのコップを使って、2人で半々に分けるにはどうしたら良い？",
                character: null
            },
            {
                text: "[あなた]この問題は、油分け算だ！",
                character: null
            },
            {
                text: "[あなた]（ここは頑張らないと...！）よしっ、解いてみよう！",
                character: null
            },
        ];

        let currentIndex = 0;
        const storyText = document.getElementById("story-text");
        const textbox = document.getElementById("text-box");
        const characterImg = document.getElementById("character");
        const choicesDiv = document.getElementById("choices");

        let isTyping = false;

        let indicator;

        let typeText = (text, callback) => {
            let i = 0;
            storyText.textContent = "";
            isTyping = true;
            // nextButton.disabled = true;
            textbox.disabled = true;

            if (indicator) {
                indicator.remove();
                indicator = null;
            }

            const interval = setInterval(() => {
                storyText.textContent += text.charAt(i);
                i++;
                if (i >= text.length) {
                    clearInterval(interval);
                    isTyping = false;
                    textbox.disabled = false;

                    showIndicator();

                    if (callback) callback();
                }
            }, 50); // 表示間隔（ミリ秒）
        }

        let showIndicator = () => {
            indicator = document.createElement("span");
            indicator.id = "next-indicator";
            indicator.textContent = "▶︎";
            storyText.appendChild(indicator);
        }

        let showNext = () => {

            if (currentIndex < story.length) {
                const { text, character } = story[currentIndex];

                // キャラクター表示/非表示
                if (character) {
                    characterImg.src = character;
                    characterImg.style.display = "block";
                } else {
                    characterImg.style.display = "none";
                }

                typeText(text);
                currentIndex++;

            } else {

                /* 選択肢メニュー表示 */
                storyText.style.display = "none";
                choicesDiv.style.display = "block";
                textbox.disabled = false;

            }
        }

        textbox.addEventListener("click", () => {
            if (!isTyping) {
                showNext();
            }
        });

        /* 選択ボタン */
        const next = document.querySelector("#next");
        const reload = document.querySelector("#reload");
        const map_back = document.querySelector("#map_back");

        next.addEventListener("click", () => {

            document.querySelector("#game-container").style.display = "none";
            $('#explanation').fadeIn();

        });

        reload.addEventListener("click", () => {

            location.reload();

        });

        map_back.addEventListener("click", () => {

            textbox.textContent = "左下のMENUからホームボタンをタップして、ダンジョンマップにお戻りください。";

        });

        // 最初のストーリー表示
        showNext();

        const top_back = document.querySelector(".top");

        top_back.addEventListener("click", () => {

            $('body,html').animate({
                scrollTop: $("#explanation").offset().top
            }, 1000);

            return false;

        });

    </script>

    <!-- lightbox2 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"
        integrity="sha512-Ixzuzfxv1EqafeQlTCufWfaC6ful6WFqIz4G+dWvK0beHw0NVJwvCKSgafpy5gwNqKmgUfIBraVwkKI+Cz0SEQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css"
        integrity="sha512-ZKX+BvQihRJPA8CROKBhDNvoc2aDMOdAlcm7TUQY+35XYtrd3yh95QOOhsPDQY9QnKE0Wqag9y38OIgEvb88cA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- lightbox2 options -->
    <script>
        lightbox.option({
            "alwaysShowNavOnTouchDevices": true,
            "disableScrolling": true
        })

    </script>

</body>

</html>