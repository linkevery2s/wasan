<!DOCTYPE html>
<html lang="ja">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
    <meta charset="UTF-8" name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <title>測量の間</title>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <!-- font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"
        integrity="sha512-GWzVrcGlo0TxTRvz9ttioyYJ+Wwk9Ck0G81D+eO63BaqHaJ3YZX9wuqjwgfcV/MrB2PhaVX9DkYVhbFpStnqpQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Katex -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8"
        crossorigin="anonymous"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
        crossorigin="anonymous"></script>

    <!-- $などで囲うために必要 -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "\\[", right: "\\]", display: true },
                    { left: "$", right: "$", display: false }
                ]
            });
        });
    </script>

    <!-- novel ui 共通 -->
    <link rel="stylesheet" href="./css/novel.css">

    <style>
        #game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
            box-sizing: border-box;
            background: url('./images/rpg/bg_surveying.jpg') no-repeat center center;
            background-size: cover;
        }

        #explanation {
            display: none;
            background: #ffffff;
            padding: 1rem;
            background-image: url("./images/background/7.jpg");
            background-repeat: repeat-y;
            background-position: right;
            background-size: 25%;
            max-width: 800px;
            text-align: left;

        }

        #overlay {
            width: 100%;
            height: 120vh;
            position: fixed;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, .8);
            display: none;
            z-index: 10;
        }

        #image-src {
            display: none;
            height: 85%;
            max-height: 800px;
            left: 50%;
            position: fixed;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 95%;
            max-width: 600px;
            z-index: 11;
            background: #ffffff;
            padding: .3em;
            border-radius: .3em;
        }

        #image-link {
            width: 100%;
            height: 80%;
            max-height: 700px;
        }

        iframe {
            border: none;
        }

        #closed-btn {
            position: absolute;
            right: 4px;
            color: #ffffff;
            background: #eb6ea5;
            cursor: pointer;
            text-align: center;
            font-weight: bolder;
            border-radius: .3em;
        }

        #closed-btn:hover {
            background: #ffffff;
            color: #9d5b8b;
            border: 1px solid #9d5b8b;
        }

        a{
            text-decoration: none;
        }

        #literature {
            color: #95949a;
            font-weight: bolder;
        }

        #literature a {
            color: #95949a;
            border-bottom: 1px dotted #95949a;
        }
    </style>
</head>

<body>
    <div id="game-container">
        <img id="character" src="" alt="画像" style="display: none;">
        <div id="text-box">
            <div id="story-text"></div>
            <div id="choices">
                <div class="choice-button" id="next">・解説に進む ▶︎</div>
                <div class="choice-button" id="reload">・もう一度、話を聞く ▶︎</div>
                <div class="choice-button" id="map_back">・マップに戻る ▶︎</div>
            </div>
        </div>

        <div class="attribution">
            桜・東京スカイツリー、東京都 <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY
                4.0</a>
        </div>

        <div class="div_right" id="skip">
            <span class="skip">Skip</span>
        </div>

    </div>

    <center>
        <div id="explanation" class="p-5">

            <div class="item_title text-xl mb-3"><img src="./images/icon/kyampu.svg" id="img_midashi" alt="kyampuのアイコン">
                古来の測量技術</div>
            <div class="grid">
                <div class="grid-inline"><a href="./data/korai1.jpg" data-lightbox="古来の測量技術" data-title="青森県三内丸山遺跡"><img
                            src="./data/korai1.jpg" alt="青森県三内丸山遺跡" width="100%"></a></div>
                <div class="grid-inline" onclick="korai()"><img src="./data/korai2.jpg" alt="青森県三内丸山遺跡（AR・VR）"
                        class="ar" width="100%">
                </div>
            </div>

            <span class="kaisetu-btn px-3 py-2 my-3 rounded-lg" onclick="below(6)">解 説 <i
                    class="fa-solid fa-circle-chevron-down"></i></span>

            <div id="6" class="kaisetu mt-3">
                <p>青森県の三内丸山遺跡には、大型掘立柱建物跡がある。柱の直径は約1mで、柱穴の間隔、幅、深さがそれぞれ4.2m、2m、2mで全て一致する。日本では、縄文時代から測量技術が存在したことになる。</p>
            </div>

            <div id="literature" class="text-xs mt-5">
                <p><a href="https://cb.bunka.go.jp/ja" target="_blank">文化財デジタルコンテンツ</a>, 文化庁, <a
                        href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank">CC BY 4.0</a></p>
                <p class="mt-2"><a href="https://ja.wikipedia.org/wiki/%E6%8E%98%E7%AB%8B%E6%9F%B1%E5%BB%BA%E7%89%A9"
                        target="_blank">掘立柱建物</a>,Wikipedia</p>
            </div>

            <br><br><br>

            <div class="div_right" id="story_back">
                <span class="top"><i class="fa-solid fa-angles-up"></i> TOP</span>
                <span class="story_back" onclick="location.reload();">Story Back</span>
            </div>

            <!-- image popup -->
            <div id="image-src"><span id="closed-btn" class="py-2 px-3 text-xs">閉じる</span>

                <div id="image-link" class="mt-10"></div>

            </div>

            <!-- ポップアップ用のoverlay -->
            <div id="overlay"></div>

        </div>
    </center>

    <script type="module">
        const story = [
            {
                text: "[あなた]ここは…どこだろう？ 遠くまで道が続いていて、地面がしっかり見える。",
                character: null
            },
            {
                text: "[？？？]一歩一歩を確かめれば、道の形は必ず見えてきます。",
                character: null
            },
            {
                text: "[あなた]え？ 今の声は…？",
                character: null
            },
            {
                text: "[伊能忠敬]私は伊能忠敬。日本の国土を測り歩いた者です。",
                character: "./images/rpg/set_inoutadataka.jpg"
            },
            {
                text: "[あなた]伊能忠敬！？ 日本地図を作った、あの伊能先生ですか！？",
                character: null
            },
            {
                text: "[人物紹介]伊能忠敬（1745–1818）。江戸時代後期の測量家。",
                character: "./images/rpg/set_inoutadataka.jpg"
            },
            {
                text: "[人物紹介]50歳を過ぎてから測量を志し、日本全国を歩いて精密な地図を完成させた。",
                character: "./images/rpg/set_inoutadataka.jpg"
            },
            {
                text: "[伊能忠敬]測量とは、感覚ではなく数を信じる仕事です。",
                character: "./images/rpg/set_inoutadataka.jpg"
            },
            {
                text: "[あなた]確かに…少しの誤差が、大きな違いになりますね。",
                character: null
            },
            {
                text: "[伊能忠敬]和算も同じ。小さな計算の積み重ねが、正しい答えへ導きます。",
                character: "./images/rpg/set_inoutadataka.jpg"
            },
            {
                text: "[あなた]一気に解こうとせず、順番に考えればいいんですね。",
                character: null
            },
            {
                text: "[伊能忠敬]その通り。焦らず、確実に進みなさい。",
                character: "./images/rpg/set_inoutadataka.jpg"
            },
            {
                text: "[テーマ]古来の測量技術を見てみよう！",
                character: null
            },
            {
                text: "[あなた]古来の測量技術...楽しみだ！！！",
                character: null
            }
        ];

        let currentIndex = 0;
        const storyText = document.getElementById("story-text");
        const textbox = document.getElementById("text-box");
        const characterImg = document.getElementById("character");
        const choicesDiv = document.getElementById("choices");

        let isTyping = false;

        let indicator;

        let typeText = (text, callback) => {
            let i = 0;
            storyText.textContent = "";
            isTyping = true;
            // nextButton.disabled = true;
            textbox.disabled = true;

            if (indicator) {
                indicator.remove();
                indicator = null;
            }

            const interval = setInterval(() => {
                storyText.textContent += text.charAt(i);
                i++;
                if (i >= text.length) {
                    clearInterval(interval);
                    isTyping = false;
                    textbox.disabled = false;

                    showIndicator();

                    if (callback) callback();
                }
            }, 50); // 表示間隔（ミリ秒）
        }

        let showIndicator = () => {
            indicator = document.createElement("span");
            indicator.id = "next-indicator";
            indicator.textContent = "▶︎";
            storyText.appendChild(indicator);
        }

        let showNext = () => {

            if (currentIndex < story.length) {
                const { text, character } = story[currentIndex];

                // キャラクター表示/非表示
                if (character) {
                    characterImg.src = character;
                    characterImg.style.display = "block";
                } else {
                    characterImg.style.display = "none";
                }

                typeText(text);
                currentIndex++;

            } else {

                /* 選択肢メニュー表示 */
                storyText.style.display = "none";
                choicesDiv.style.display = "block";
                textbox.disabled = false;

            }
        }

        textbox.addEventListener("click", () => {
            if (!isTyping) {
                showNext();
            }
        });

        /* 選択ボタン */
        const next = document.querySelector("#next");
        const reload = document.querySelector("#reload");
        const map_back = document.querySelector("#map_back");

        next.addEventListener("click", () => {

            document.querySelector("#game-container").style.display = "none";
            $('#explanation').fadeIn();

        });

        reload.addEventListener("click", () => {

            location.reload();

        });

        map_back.addEventListener("click", () => {

            textbox.textContent = "左下のMENUからホームボタンをタップして、ダンジョンマップにお戻りください。";

        });

        // 最初のストーリー表示
        showNext();

        const top_back = document.querySelector(".top");

        top_back.addEventListener("click", () => {

            $('body,html').animate({
                scrollTop: $("#explanation").offset().top
            }, 1000);

            return false;

        });

        /* スキップボタン */
        const skip = document.querySelector(".skip");

        skip.addEventListener("click", () => {

            document.querySelector("#game-container").style.display = "none";
            $('#explanation').fadeIn();

        });


        const image_link = document.querySelector("#image-link");
        const literature = document.querySelector("#literature");

        let image_src = () => {
            $('#overlay').fadeIn();
            $('#image-src').fadeIn();
        };

        window.korai = () => {

            image_link.innerHTML = '<iframe src = "./aomoriiseki.html" width="100%" height="100%" border="0"></iframe>';

            //literature.innerHTML = "<a href='https://cb.bunka.go.jp/ja' target='_blank'>文化財デジタルコンテンツ</a>、文化庁、<a href='https://creativecommons.org/licenses/by/4.0/deed.ja' target='_blank'>CC BY 4.0</a>";

            image_src();

        };

        const closed_btn = document.querySelector("#closed-btn");

        closed_btn.addEventListener('click', () => {
            $('#overlay').fadeOut();
            $('#image-src').fadeOut();
        });


    </script>

    <!-- lightbox2 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"
        integrity="sha512-Ixzuzfxv1EqafeQlTCufWfaC6ful6WFqIz4G+dWvK0beHw0NVJwvCKSgafpy5gwNqKmgUfIBraVwkKI+Cz0SEQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css"
        integrity="sha512-ZKX+BvQihRJPA8CROKBhDNvoc2aDMOdAlcm7TUQY+35XYtrd3yh95QOOhsPDQY9QnKE0Wqag9y38OIgEvb88cA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- lightbox2 options -->
    <script>
        lightbox.option({
            "alwaysShowNavOnTouchDevices": true,
            "disableScrolling": true
        })

    </script>

</body>

</html>